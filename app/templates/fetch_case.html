{% extends 'base.html' %}

{% block content %}
<div class="form-container">
    <h3>Case Status: Search by Case Number</h3>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" action="/fetch-case">
        <label for="court_complex">Court Complex *</label>
        <select id="court_complex" name="court_complex" required>
            <option value="">Select Court Complex</option>
            <option value="1">District Court, Faridabad</option>
        </select>

        <label for="case_type">Case Type *</label>
        <select id="case_type" name="case_type" required>
            <option value="">--Select Case Type--</option>
            <option>District & Sessions Court</option>
            <option>Chief Judicial Magistrate Court</option>
            <option>Additional District Court</option>
            <option>Senior Civil Judge Court</option>
            <option>Junior Civil Judge Court</option>
            <option>Family Court (District Level)</option>
            <option>Fast Track District Court</option>
        </select>

        <label for="case_number">Case Number *</label>
        <input type="text" id="case_number" name="case_number" required placeholder="Enter Case Number">

        <label for="year">Filing Year *</label>
        <input type="text" id="year" name="year" required placeholder="e.g. 2022">

<!--        <div class="captcha-box">-->
<!--            <label for="captcha" class="captcha-label">Enter captcha: <span style="color:red">*</span></label>-->

<!--            &lt;!&ndash; Captcha Display and Refresh Button &ndash;&gt;-->
<!--            <div class="captcha-container" style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">-->
<!--                <span id="captcha-text" style="font-size: 20px; font-weight: bold;">{{ captcha_text }}</span>-->
<!--                <button type="button" onclick="refreshCaptcha();" aria-label="Refresh Captcha" title="Refresh Captcha" style="background: none; border: none; font-size: 18px; cursor: pointer;">-->
<!--                    ðŸ”„-->
<!--                </button>-->
<!--            </div>-->

<!--            &lt;!&ndash; Captcha Input &ndash;&gt;-->
<!--            <div style="margin-top: 10px;">-->
<!--                <input type="text" name="captcha" id="captcha" placeholder="Enter CAPTCHA" required-->
<!--                       style="padding: 6px 10px; width: 100%; box-sizing: border-box;">-->
<!--            </div>-->
<!--        </div>-->
            <div class="captcha-box">
                <label for="captcha">Enter Captcha *</label>


                <!-- Line 1: Captcha Image + Refresh -->
                <div style="display: flex; align-items: center; margin-top: 5px;">
                    <img id="captchaImage" src="{{ url_for('main.generate_captcha') }}" alt="CAPTCHA" style="border: 1px solid #ccc; height: 35px; margin-right: 6px;">
                    <a href="#" onclick="refreshCaptcha(); return false;" title="Refresh Captcha">ðŸ”„</a>
                </div>
                <br>
                <!-- Line 2: Input Field -->
                <div style="margin-top: 10px;">
                    <input type="text" name="captcha" id="captcha" placeholder="Enter Captcha" required>
                </div>
            </div>



        <div class="buttons mt-3">
            <button type="submit">Search</button>
            <button type="reset">Reset</button>
        </div>
    </form>
</div>

<script>
    function refreshCaptcha() {
        fetch("/new-captcha")
            .then(response => response.text())
            .then(data => {
                document.getElementById("captcha-text").innerText = data;
            });
    }
</script>
<script>
    function refreshCaptcha() {
        const img = document.getElementById("captchaImage");
        img.src = "{{ url_for('main.generate_captcha') }}" + "?_=" + new Date().getTime(); // Prevent caching
    }
</script>

{% endblock %}
